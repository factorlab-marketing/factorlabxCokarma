<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FactorLab x CoKarma - Pitch Deck</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary-color: #0d9488;
            /* Teal 600 */
            --bg-color: #0f172a;
            /* Slate 900 */
            --text-color: #f1f5f9;
            /* Slate 100 */
            --control-bg: rgba(15, 23, 42, 0.8);
            --control-hover: rgba(30, 41, 59, 0.9);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Main Viewport */
        .deck-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 20px;
            background-image: radial-gradient(#1e293b 1px, transparent 1px);
            background-size: 40px 40px;
        }

        .slide-frame {
            width: 1280px;
            height: 720px;
            border: none;
            border-radius: 12px;
            background-color: white;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease;
            max-width: 100%;
            max-height: 100%;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            inset: 0;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
            transition: opacity 0.5s ease;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #334155;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Controls */
        .controls-bar {
            height: 80px;
            background-color: var(--bg-color);
            border-top: 1px solid #334155;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            z-index: 100;
        }

        .deck-info {
            display: flex;
            flex-direction: column;
        }

        .deck-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            color: white;
        }

        .deck-subtitle {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-btn {
            background-color: #1e293b;
            color: white;
            border: 1px solid #334155;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.2rem;
        }

        .nav-btn:hover:not(:disabled) {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.4);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #0f172a;
        }

        .slide-counter {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            color: #e2e8f0;
            min-width: 60px;
            text-align: center;
        }

        .progress-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: #1e293b;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--primary-color);
        }

        .fullscreen-btn {
            background: transparent;
            border: 1px solid transparent;
            color: #94a3b8;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .fullscreen-btn:hover {
            color: white;
            background-color: #334155;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .controls-bar {
                padding: 0 20px;
            }

            .deck-title {
                font-size: 0.9rem;
            }

            .deck-subtitle {
                display: none;
            }

            .slide-frame {
                border-radius: 0;
            }
        }
    </style>
</head>

<body>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Main Content -->
    <div class="deck-container">
        <div class="loading-overlay" id="loader">
            <div class="loading-spinner"></div>
        </div>
        <!-- Double buffer frames for smooth transitions and preloading -->
        <iframe class="slide-frame" id="slideFrameA" src="" title="Presentation Slide"></iframe>
        <iframe class="slide-frame" id="slideFrameB" src="" title="Presentation Slide"
            style="display: none; opacity: 0; position: absolute;"></iframe>

    </div>

    <!-- Controls -->
    <footer class="controls-bar">
        <div class="deck-info">
            <span class="deck-title">FactorLab x CoKarma</span>
            <span class="deck-subtitle">Employee Investing Session</span>
        </div>

        <div class="nav-controls">
            <button class="nav-btn" id="prevBtn" title="Previous Slide (Arrow Left)">
                <i class="fas fa-arrow-left"></i>
            </button>

            <div class="slide-counter">
                <span id="currentSlideNum">1</span> / <span id="totalSlidesNum">--</span>
            </div>

            <button class="nav-btn" id="nextBtn" title="Next Slide (Arrow Right)">
                <i class="fas fa-arrow-right"></i>
            </button>

            <!-- Theme Toggle -->
            <button class="nav-btn" id="themeBtn" title="Toggle Dark Mode">
                <i class="fas fa-moon"></i>
            </button>
        </div>

        <button class="fullscreen-btn" id="fullscreenBtn" title="Toggle Fullscreen (F)">
            <i class="fas fa-expand"></i>
        </button>
    </footer>

    <script>
        // Configuration
        const TOTAL_SLIDES = 14;
        let currentSlide = 1;
        let isDarkTheme = false;
        let activeFrameId = 'slideFrameA';
        let preloadFrameId = 'slideFrameB';

        // Dark Theme CSS Injection (unchanged content, just condensed for script block)
        const DARK_THEME_CSS = `
            body { background-color: #0f172a !important; }
            .slide-container { background-color: #0f172a !important; color: #f1f5f9 !important; }
            h1, h2, h3, h4, .text-gray-900, .text-gray-800, .text-gray-700, .text-gray-600 { color: #f1f5f9 !important; }
            .text-gray-500 { color: #cbd5e1 !important; } .text-gray-400 { color: #94a3b8 !important; }
            .bg-white { background-color: #1e293b !important; border-color: #334155 !important; }
            .bg-gray-50, .bg-gray-100 { background-color: #334155 !important; }
            .bg-f3f4f6 { background-color: #0f172a !important; }
            .poll-card, .pain-point-card, .scenario-card, .feature-box, .glass-panel, .step-card, .option-card, .content-card, .contact-card, .story-card, .list-item, .modal-content, .delay-badge, .mindset-card, .salary-connected, .arrow-circle {
                background-color: #1e293b !important; border: 1px solid #334155 !important; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5) !important;
            }
            .wealth-connected { background: linear-gradient(145deg, #1e293b, #115e59) !important; border-color: #0d9488 !important; }
            .salary-title, .wealth-title { color: #f1f5f9 !important; } .salary-desc, .wealth-desc { color: #94a3b8 !important; }
            .icon-small { background-color: #334155 !important; color: #cbd5e1 !important; } .wealth-active .icon-small { background-color: #115e59 !important; color: #5eead4 !important; }
            .close-btn { color: #cbd5e1 !important; } .close-btn:hover { color: #f87171 !important; }
            .border-gray-200, .border-gray-100, .border-gray-300 { border-color: #334155 !important; }
            .text-teal-600, .text-teal-700, .text-teal-800 { color: #2dd4bf !important; } .text-blue-600 { color: #60a5fa !important; }
            .text-indigo-600 { color: #818cf8 !important; } .text-orange-600 { color: #fb923c !important; } .text-purple-600 { color: #c084fc !important; }
            .bg-teal-50, .bg-teal-100 { background-color: rgba(45, 212, 191, 0.1) !important; } .bg-blue-50, .bg-blue-100 { background-color: rgba(96, 165, 250, 0.1) !important; }
            .bg-orange-50, .bg-orange-100 { background-color: rgba(251, 146, 60, 0.1) !important; } .bg-purple-50, .bg-purple-100 { background-color: rgba(192, 132, 252, 0.1) !important; }
            .shadow-sm, .shadow-md, .shadow-lg, .shadow-xl { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5) !important; }
            canvas { filter: brightness(0.9) contrast(1.1); }
        `;

        // DOM Elements
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const themeBtn = document.getElementById('themeBtn');
        const currentNumEl = document.getElementById('currentSlideNum');
        const totalNumEl = document.getElementById('totalSlidesNum');
        const progressBar = document.getElementById('progressBar');
        const loader = document.getElementById('loader');
        const fullscreenBtn = document.getElementById('fullscreenBtn');

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            totalNumEl.textContent = TOTAL_SLIDES;

            // Initial load
            loadSlideIntoFrame(activeFrameId, currentSlide, true);
            preloadNext();
            updateUI();
        });

        // Functions
        function getActiveFrame() { return document.getElementById(activeFrameId); }
        function getPreloadFrame() { return document.getElementById(preloadFrameId); }

        function loadSlideIntoFrame(frameId, slideIndex, isVisible) {
            const frame = document.getElementById(frameId);
            frame.src = `slides/slide_${slideIndex}.html`;

            frame.onload = () => {
                // Apply theme
                sendThemeMessageToFrame(frame);

                // Keyboard setup
                try {
                    const iframeDoc = frame.contentDocument || frame.contentWindow.document;
                    iframeDoc.addEventListener('keydown', handleKeyDown);
                    if (isVisible) window.focus(); // Keep focus out unless clicked
                } catch (e) { }
            };
        }

        function switchFrames() {
            const active = getActiveFrame();
            const preload = getPreloadFrame();

            // Swap IDs conceptually
            const temp = activeFrameId;
            activeFrameId = preloadFrameId;
            preloadFrameId = temp;

            // Animate
            active.style.opacity = '0';
            setTimeout(() => { active.style.display = 'none'; }, 300);

            preload.style.display = 'block';
            // Force reflow
            void preload.offsetWidth;
            preload.style.opacity = '1';

            // Ensure newly active frame has theme
            sendThemeMessageToFrame(preload);
        }

        function preloadNext() {
            if (currentSlide < TOTAL_SLIDES) {
                loadSlideIntoFrame(preloadFrameId, currentSlide + 1, false);
            }
        }

        function preloadPrev() {
            if (currentSlide > 1) {
                loadSlideIntoFrame(preloadFrameId, currentSlide - 1, false);
            }
        }

        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            const icon = themeBtn.querySelector('i');
            icon.className = isDarkTheme ? 'fas fa-sun' : 'fas fa-moon';

            sendThemeMessageToFrame(getActiveFrame());
            sendThemeMessageToFrame(getPreloadFrame());
        }

        function sendThemeMessageToFrame(frame) {
            if (frame && frame.contentWindow) {
                frame.contentWindow.postMessage({
                    type: 'theme-update',
                    isDark: isDarkTheme,
                    css: DARK_THEME_CSS
                }, '*');
            }
        }

        function updateUI() {
            currentNumEl.textContent = currentSlide;
            const percentage = ((currentSlide - 1) / (TOTAL_SLIDES - 1)) * 100;
            progressBar.style.width = `${percentage}%`;
            prevBtn.disabled = currentSlide === 1;
            nextBtn.disabled = currentSlide === TOTAL_SLIDES;
        }

        function goToNext() {
            if (currentSlide < TOTAL_SLIDES) {
                currentSlide++;

                // Check if preload frame has the right slide (optimization)
                // For simplicity in this logic, we'll just reload the active frame pointer
                // In a perfect world we'd check if preloadFrame.src ends with the right slide
                // ignoring that optimization for stability:

                const nextFrame = getPreloadFrame();
                // Simple check if it's already loaded?
                if (!nextFrame.src.includes(`slide_${currentSlide}.html`)) {
                    loadSlideIntoFrame(preloadFrameId, currentSlide, false);
                    // Give it a moment or wait for load? For responsiveness, we load then switch.
                    // But if we want instant switch, we assume preloader did its job.
                }

                switchFrames();
                preloadNext(); // Prepare for next
                updateUI();
            }
        }

        function goToPrev() {
            if (currentSlide > 1) {
                currentSlide--;

                const nextFrame = getPreloadFrame();
                if (!nextFrame.src.includes(`slide_${currentSlide}.html`)) {
                    loadSlideIntoFrame(preloadFrameId, currentSlide, false);
                }

                switchFrames();
                preloadPrev(); // Heuristic: user might go back further
                updateUI();
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                }
            }
        }

        function handleKeyDown(e) {
            if (e.key === 'ArrowRight' || e.key === 'Space') {
                goToNext();
            } else if (e.key === 'ArrowLeft') {
                goToPrev();
            } else if (e.key.toLowerCase() === 'f') {
                toggleFullscreen();
            }
        }

        // Event Listeners
        prevBtn.addEventListener('click', goToPrev);
        nextBtn.addEventListener('click', goToNext);
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        themeBtn.addEventListener('click', toggleTheme);
        document.addEventListener('keydown', handleKeyDown);

        setTimeout(() => {
            loader.style.opacity = '0';
            loader.style.pointerEvents = 'none';
        }, 800);

    </script>
</body>

</html>